# Open WebUI MCP工具调用测试指南

## 🔍 问题诊断

当前状态：
- ✅ MCPO服务器正常运行 (端口8005)
- ✅ Open WebUI已连接并发现工具
- ❌ LLM没有自动调用工具

## 🧪 测试步骤

### 1. 确认工具已被发现
在Open WebUI的设置中检查：
- External Services状态应为绿色/已连接
- 应该显示发现了5个工具

### 2. 测试不同的询问方式

#### 方式A：直接明确的请求
```
请使用get_stock_price工具查询688469的价格
```

#### 方式B：自然语言查询
```
688469这只股票现在多少钱？
```

#### 方式C：更具体的描述
```
我想了解股票代码688469的最新价格信息
```

### 3. 检查工具调用配置

可能需要在Open WebUI中启用以下选项：
- Function Calling / Tool Calling
- Auto Function Calling
- External API Integration

### 4. 模型兼容性检查

确认使用的模型支持工具调用：
- Qwen2.5:7b通常支持工具调用
- 检查模型是否有特殊的工具调用格式要求

## 🔧 可能的解决方案

### 解决方案1：优化工具描述
如果测试失败，可以尝试更详细的工具描述：

```python
description="当用户询问股票价格、股价、多少钱时，调用此工具获取实时股票价格信息。适用于任何中国股票代码查询。"
```

### 解决方案2：检查Open WebUI版本
某些版本的Open WebUI可能需要特定配置才能启用工具调用。

### 解决方案3：系统提示词
可能需要在模型设置中添加系统提示词：
```
你是一个股票分析助手。当用户询问股票相关信息时，你应该使用可用的工具来获取实时数据，而不是依赖训练数据中的过时信息。
```

## 📊 预期结果

如果工具调用成功，应该看到：

1. **MCPO日志中出现调用记录**：
   ```
   INFO - Calling endpoint: get_stock_price, with args: {'stock_code': '688469'}
   ```

2. **LLM返回实时数据**：
   - 最新价格: 5.62元
   - 开盘价格: 5.64元
   - 成交量等详细信息

3. **不会出现"我无法提供具体价格"这类回复**

## ⚡ 立即测试

现在请尝试在Open WebUI中输入：

**测试1**: `请调用get_stock_price工具查询688469`
**测试2**: `688469股票现在什么价格？`

如果仍然失败，请告诉我具体的错误信息或模型回复。