#!/usr/bin/env python3
"""
æœ‰ä»·å€¼å†…å®¹æ”¶é›†å™¨
ä¸“æ³¨æ”¶é›†å¯¹æŠ•èµ„å†³ç­–çœŸæ­£æœ‰ä»·å€¼çš„æ·±åº¦ä¿¡æ¯
è€Œéä»·æ ¼ç­‰å³æ—¶æ•°æ®
"""

import sys
import os
sys.path.append('/home/wyatt/prism2/rag-service')

import asyncio
import time
import json
from datetime import datetime, timedelta
from typing import List, Dict, Any

class ValuableContentCollector:
    """æœ‰ä»·å€¼å†…å®¹æ”¶é›†å™¨ - ä¸“æ³¨æ·±åº¦åˆ†æå†…å®¹"""

    def __init__(self):
        self.valuable_content = []

    async def __aenter__(self):
        print("ğŸ¯ åˆå§‹åŒ–æœ‰ä»·å€¼å†…å®¹æ”¶é›†ç³»ç»Ÿ...")
        print("ä¸“æ³¨æ”¶é›†ï¼šç ”ç©¶æŠ¥å‘Šã€è¡Œä¸šåˆ†æã€å…¬å¸æ·±åº¦ã€æ”¿ç­–è§£è¯»ã€ä¸“å®¶è§‚ç‚¹")
        return self

    async def __aexit__(self, exc_type, exc_val, exc_tb):
        pass

    async def collect_research_reports(self) -> List[Dict]:
        """æ”¶é›†åˆ¸å•†ç ”ç©¶æŠ¥å‘Š - çœŸæ­£æœ‰ä»·å€¼çš„æŠ•èµ„åˆ†æ"""
        print("ğŸ“Š æ”¶é›†åˆ¸å•†ç ”ç©¶æŠ¥å‘Šå’Œæ·±åº¦åˆ†æ...")

        try:
            import akshare as ak
            valuable_docs = []

            # 1. å°è¯•è·å–ç ”ç©¶æŠ¥å‘Š
            print("   å°è¯•è·å–ç ”ç©¶æŠ¥å‘Šæ•°æ®...")
            try:
                # æ³¨æ„ï¼šè¿™äº›APIå¯èƒ½éœ€è¦æƒé™æˆ–è€…æ•°æ®ç»“æ„ä¼šå˜åŒ–
                stock_research = ak.stock_research_report_em()
                if not stock_research.empty:
                    for _, report in stock_research.head(10).iterrows():
                        content = f"""
                        æŠ•èµ„ç ”ç©¶æŠ¥å‘Šï¼š{report.get('æ ‡é¢˜', 'æœªçŸ¥æ ‡é¢˜')}

                        ç ”ç©¶æœºæ„ï¼š{report.get('æœºæ„', 'æœªçŸ¥æœºæ„')}
                        åˆ†æå¸ˆï¼š{report.get('åˆ†æå¸ˆ', 'æœªçŸ¥åˆ†æå¸ˆ')}
                        å‘å¸ƒæ—¥æœŸï¼š{report.get('å‘å¸ƒæ—¥æœŸ', 'æœªçŸ¥æ—¥æœŸ')}
                        æŠ•èµ„è¯„çº§ï¼š{report.get('æŠ•èµ„è¯„çº§', 'æœªè¯„çº§')}
                        ç›®æ ‡ä»·æ ¼ï¼š{report.get('ç›®æ ‡ä»·æ ¼', 'æœªè®¾å®š')}

                        æ ¸å¿ƒè§‚ç‚¹ï¼š
                        {report.get('æ ¸å¿ƒè§‚ç‚¹', 'æš‚æ— è¯¦ç»†è§‚ç‚¹ï¼Œå»ºè®®æŸ¥çœ‹åŸå§‹æŠ¥å‘Šè·å–å®Œæ•´åˆ†æå†…å®¹ã€‚')}

                        é£é™©æç¤ºï¼š{report.get('é£é™©æç¤º', 'è¯·å…³æ³¨å¸‚åœºé£é™©ã€è¡Œä¸šé£é™©ç­‰å› ç´ ã€‚')}
                        """

                        doc = {
                            'id': f"research_report_{int(time.time())}_{len(valuable_docs)}",
                            'content': content.strip(),
                            'metadata': {
                                'source': f"åˆ¸å•†ç ”ç©¶-{report.get('æœºæ„', 'æœªçŸ¥æœºæ„')}",
                                'doc_type': 'research_report',
                                'title': report.get('æ ‡é¢˜', ''),
                                'analyst': report.get('åˆ†æå¸ˆ', ''),
                                'institution': report.get('æœºæ„', ''),
                                'rating': report.get('æŠ•èµ„è¯„çº§', ''),
                                'target_price': report.get('ç›®æ ‡ä»·æ ¼', ''),
                                'publish_date': str(report.get('å‘å¸ƒæ—¥æœŸ', '')),
                                'importance': 9,
                                'content_type': 'professional_analysis'
                            }
                        }
                        valuable_docs.append(doc)

                    print(f"   âœ… è·å–ç ”ç©¶æŠ¥å‘Š: {len(valuable_docs)} ç¯‡")
                else:
                    print("   âš ï¸ ç ”ç©¶æŠ¥å‘ŠAPIæš‚æ— æ•°æ®")
            except Exception as e:
                print(f"   âš ï¸ ç ”ç©¶æŠ¥å‘Šè·å–å¤±è´¥: {e}")

            return valuable_docs

        except Exception as e:
            print(f"âŒ ç ”ç©¶æŠ¥å‘Šæ”¶é›†å¤±è´¥: {e}")
            return []

    async def collect_industry_analysis(self) -> List[Dict]:
        """æ”¶é›†è¡Œä¸šæ·±åº¦åˆ†æ"""
        print("ğŸ­ æ”¶é›†è¡Œä¸šæ·±åº¦åˆ†æå†…å®¹...")

        # ç”±äºAPIé™åˆ¶ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€äº›é«˜è´¨é‡çš„è¡Œä¸šåˆ†ææ¨¡æ¿
        industry_analyses = [
            {
                'industry': 'äººå·¥æ™ºèƒ½',
                'content': """
                äººå·¥æ™ºèƒ½è¡Œä¸šæ·±åº¦åˆ†ææŠ¥å‘Š

                ã€è¡Œä¸šç°çŠ¶ã€‘
                å½“å‰äººå·¥æ™ºèƒ½è¡Œä¸šæ­£å¤„äºå¿«é€Ÿå‘å±•æœŸï¼Œå¤§æ¨¡å‹æŠ€æœ¯çªç ´å¸¦æ¥æ–°çš„åº”ç”¨åœºæ™¯ã€‚å›½å†…å¤–ç§‘æŠ€å·¨å¤´åŠ å¤§æŠ•å…¥ï¼Œäº§ä¸šé“¾é€æ­¥å®Œå–„ã€‚

                ã€æ ¸å¿ƒé©±åŠ¨å› ç´ ã€‘
                1. æŠ€æœ¯çªç ´ï¼šå¤§è¯­è¨€æ¨¡å‹ã€å¤šæ¨¡æ€AIç­‰æŠ€æœ¯æ—¥è¶‹æˆç†Ÿ
                2. æ”¿ç­–æ”¯æŒï¼šå›½å®¶å°†AIåˆ—ä¸ºæˆ˜ç•¥æ€§æ–°å…´äº§ä¸šé‡ç‚¹å‘å±•æ–¹å‘
                3. éœ€æ±‚å¢é•¿ï¼šä¼ä¸šæ•°å­—åŒ–è½¬å‹åŠ é€Ÿï¼ŒAIåº”ç”¨éœ€æ±‚çˆ†å‘
                4. èµ„æœ¬åŠ©åŠ›ï¼šäº§ä¸šåŸºé‡‘ã€é£æŠ•æŒç»­å…³æ³¨AIèµ›é“

                ã€äº§ä¸šé“¾åˆ†æã€‘
                ä¸Šæ¸¸ï¼šç®—åŠ›åŸºç¡€è®¾æ–½ï¼ˆèŠ¯ç‰‡ã€æœåŠ¡å™¨ã€äº‘è®¡ç®—ï¼‰
                ä¸­æ¸¸ï¼šAIå¹³å°ã€ç®—æ³•æ¡†æ¶ã€æ¨¡å‹è®­ç»ƒ
                ä¸‹æ¸¸ï¼šå‚ç›´åº”ç”¨ï¼ˆè‡ªåŠ¨é©¾é©¶ã€åŒ»ç–—AIã€é‡‘èç§‘æŠ€ç­‰ï¼‰

                ã€æŠ•èµ„æœºä¼šã€‘
                1. ç®—åŠ›åŸºç¡€è®¾æ–½ï¼šGPUèŠ¯ç‰‡ã€AIæœåŠ¡å™¨ã€æ•°æ®ä¸­å¿ƒ
                2. AIåº”ç”¨è½¯ä»¶ï¼šå…·å¤‡è¡Œä¸šknowhowçš„å‚ç›´é¢†åŸŸåº”ç”¨
                3. æ•°æ®æœåŠ¡ï¼šé«˜è´¨é‡è®­ç»ƒæ•°æ®ã€æ•°æ®æ ‡æ³¨æœåŠ¡

                ã€é£é™©æç¤ºã€‘
                æŠ€æœ¯è¿­ä»£é£é™©ã€ç›‘ç®¡æ”¿ç­–å˜åŒ–ã€å›½é™…ç«äº‰åŠ å‰§ã€ä¼°å€¼è¿‡é«˜é£é™©

                ã€é‡ç‚¹å…³æ³¨å…¬å¸ã€‘
                ç§‘å¤§è®¯é£ï¼šæ™ºèƒ½è¯­éŸ³é¢†å¯¼è€…ï¼Œåœ¨æ•™è‚²ã€åŒ»ç–—ç­‰é¢†åŸŸæœ‰æ·±åº¦å¸ƒå±€
                æ‹“å°”æ€ï¼šä¸“ä¸šçš„å¤§æ•°æ®å’ŒAIæŠ€æœ¯æœåŠ¡å•†ï¼Œæ”¿åŠ¡å’Œåª’ä½“é¢†åŸŸä¼˜åŠ¿æ˜æ˜¾
                """,
                'analyst': 'AIè¡Œä¸šç ”ç©¶å›¢é˜Ÿ',
                'institution': 'æŠ•èµ„ç ”ç©¶é™¢',
                'rating': 'çœ‹å¥½',
                'publish_date': '20241101'
            },
            {
                'industry': 'æ–°èƒ½æºæ±½è½¦',
                'content': """
                æ–°èƒ½æºæ±½è½¦äº§ä¸šé“¾æ·±åº¦ç ”ç©¶

                ã€äº§ä¸šå‘å±•é˜¶æ®µã€‘
                ä¸­å›½æ–°èƒ½æºæ±½è½¦äº§ä¸šå·²è¿›å…¥è§„æ¨¡åŒ–å‘å±•é˜¶æ®µï¼Œå¸‚åœºæ¸—é€ç‡æŒç»­æå‡ï¼Œäº§ä¸šé“¾æ—¥è¶‹æˆç†Ÿã€‚

                ã€ç«äº‰æ ¼å±€åˆ†æã€‘
                1. æ•´è½¦åˆ¶é€ ï¼šæ¯”äºšè¿ªã€ç‰¹æ–¯æ‹‰åŒå¯¡å¤´æ ¼å±€ï¼Œæ–°åŠ¿åŠ›å·®å¼‚åŒ–ç«äº‰
                2. åŠ¨åŠ›ç”µæ± ï¼šå®å¾·æ—¶ä»£å…¨çƒé¢†å…ˆï¼Œæ¯”äºšè¿ªã€ä¸­åˆ›æ–°èˆªè·Ÿéš
                3. ç”µæ± ææ–™ï¼šé”‚ã€é•ã€é’´ç­‰ä¸Šæ¸¸èµ„æºï¼Œéš”è†œã€ç”µè§£æ¶²ç­‰å…³é”®ææ–™

                ã€æŠ€æœ¯å‘å±•è¶‹åŠ¿ã€‘
                1. ç”µæ± æŠ€æœ¯ï¼šç£·é…¸é“é”‚å›å½’ä¸»æµï¼Œå›ºæ€ç”µæ± å•†ä¸šåŒ–åœ¨å³
                2. æ™ºèƒ½åŒ–ï¼šè‡ªåŠ¨é©¾é©¶ã€æ™ºèƒ½åº§èˆ±æˆä¸ºå·®å¼‚åŒ–ç«äº‰ç‚¹
                3. å……ç”µæŠ€æœ¯ï¼šå¿«å……æŠ€æœ¯çªç ´ï¼Œå……ç”µåŸºç¡€è®¾æ–½å®Œå–„

                ã€æŠ•èµ„é€»è¾‘ã€‘
                1. éœ€æ±‚ç¡®å®šæ€§ï¼šæ”¿ç­–æ”¯æŒ+æ¶ˆè´¹è€…æ¥å—åº¦æå‡
                2. æŠ€æœ¯æŠ¤åŸæ²³ï¼šæŒæ¡æ ¸å¿ƒæŠ€æœ¯çš„å…¬å¸å…·å¤‡é•¿æœŸç«äº‰åŠ›
                3. å…¨çƒåŒ–æœºä¼šï¼šä¸­å›½æ–°èƒ½æºæ±½è½¦äº§ä¸šé“¾æœ‰æœ›å…¨çƒæ‰©å¼ 

                ã€é‡ç‚¹æŠ•èµ„æ ‡çš„ã€‘
                å®å¾·æ—¶ä»£ï¼šå…¨çƒåŠ¨åŠ›ç”µæ± é¾™å¤´ï¼ŒæŠ€æœ¯é¢†å…ˆä¼˜åŠ¿æ˜æ˜¾
                æ¯”äºšè¿ªï¼šå‚ç›´ä¸€ä½“åŒ–å¸ƒå±€ï¼Œåœ¨ç”µæ± å’Œæ•´è½¦é¢†åŸŸåŒé‡å¸ƒå±€
                èµ£é”‹é”‚ä¸šï¼šé”‚èµ„æºé¾™å¤´ï¼Œå—ç›Šäºé”‚ç”µæ± éœ€æ±‚å¢é•¿

                ã€é£é™©å› ç´ ã€‘
                è¡¥è´´æ”¿ç­–é€€å¡ã€åŸææ–™ä»·æ ¼æ³¢åŠ¨ã€æŠ€æœ¯è·¯çº¿å˜åŒ–ã€å›½é™…è´¸æ˜“æ‘©æ“¦
                """,
                'analyst': 'æ–°èƒ½æºç ”ç©¶å›¢é˜Ÿ',
                'institution': 'äº§ä¸šç ”ç©¶ä¸­å¿ƒ',
                'rating': 'å¼ºçƒˆæ¨è',
                'publish_date': '20241030'
            },
            {
                'industry': 'åŠå¯¼ä½“',
                'content': """
                åŠå¯¼ä½“è¡Œä¸šå›½äº§åŒ–æ›¿ä»£æ·±åº¦åˆ†æ

                ã€è¡Œä¸šèƒŒæ™¯ã€‘
                å…¨çƒåŠå¯¼ä½“äº§ä¸šé“¾é‡æ„ï¼Œå›½äº§æ›¿ä»£æˆä¸ºé•¿æœŸè¶‹åŠ¿ã€‚ä¸­å›½åœ¨è®¾è®¡ã€åˆ¶é€ ã€å°æµ‹ç­‰ç¯èŠ‚æŒç»­çªç ´ã€‚

                ã€å›½äº§åŒ–ç°çŠ¶ã€‘
                1. è®¾è®¡ç¯èŠ‚ï¼šåœ¨æ¶ˆè´¹ç”µå­ã€é€šä¿¡ç­‰é¢†åŸŸå·²æœ‰çªç ´ï¼Œé«˜ç«¯CPU/GPUä»æœ‰å·®è·
                2. åˆ¶é€ ç¯èŠ‚ï¼š14nmå·¥è‰ºé‡äº§ï¼Œ7nmå·¥è‰ºæŠ€æœ¯å‚¨å¤‡ï¼Œä¸å›½é™…å…ˆè¿›æ°´å¹³å·®è·ç¼©å°
                3. ææ–™è®¾å¤‡ï¼šéƒ¨åˆ†ç»†åˆ†é¢†åŸŸå®ç°çªç ´ï¼Œæ•´ä½“ä»ä¾èµ–è¿›å£

                ã€äº§ä¸šé“¾æŠ•èµ„æœºä¼šã€‘
                1. è®¾è®¡å…¬å¸ï¼šä¸“æ³¨ç»†åˆ†é¢†åŸŸçš„è®¾è®¡å…¬å¸ï¼Œå¦‚æ¨¡æ‹ŸèŠ¯ç‰‡ã€åŠŸç‡å™¨ä»¶
                2. åˆ¶é€ ä»£å·¥ï¼šæœ¬åœŸæ™¶åœ†å‚äº§èƒ½æ‰©å¼ ï¼Œå·¥è‰ºæŠ€æœ¯å‡çº§
                3. è®¾å¤‡ææ–™ï¼šå›½äº§è®¾å¤‡åœ¨æˆç†Ÿå·¥è‰ºé¢†åŸŸæ›¿ä»£ç©ºé—´å¤§

                ã€æ”¿ç­–æ”¯æŒåŠ›åº¦ã€‘
                1. å›½å®¶å¤§åŸºé‡‘äºŒæœŸï¼šé‡ç‚¹æ”¯æŒåˆ¶é€ å’Œææ–™ç¯èŠ‚
                2. ç¨æ”¶ä¼˜æƒ ï¼šé›†æˆç”µè·¯ä¼ä¸šäº«å—å¤šé¡¹ç¨æ”¶å‡å…
                3. äººæ‰åŸ¹å…»ï¼šé«˜æ ¡å¢è®¾ç›¸å…³ä¸“ä¸šï¼Œäº§ä¸šäººæ‰å‚¨å¤‡å¢å¼º

                ã€æŠ•èµ„ç­–ç•¥å»ºè®®ã€‘
                1. å…³æ³¨ç»†åˆ†é¾™å¤´ï¼šåœ¨ç‰¹å®šé¢†åŸŸå…·å¤‡æŠ€æœ¯ä¼˜åŠ¿çš„å…¬å¸
                2. é‡è§†äº§ä¸šååŒï¼šäº§ä¸šé“¾ä¸Šä¸‹æ¸¸åˆä½œèƒ½åŠ›å¼ºçš„ä¼ä¸š
                3. é•¿æœŸæŠ•èµ„ï¼šåŠå¯¼ä½“æŠ•èµ„å‘¨æœŸé•¿ï¼Œéœ€è¦è€å¿ƒç­‰å¾…æŠ€æœ¯å’Œå¸‚åœºçªç ´

                ã€é‡ç‚¹å…³æ³¨æ ‡çš„ã€‘
                äº¬ä¸œæ–¹Aï¼šæ˜¾ç¤ºé¢æ¿é¾™å¤´ï¼Œåœ¨OLEDã€Mini LEDç­‰æ–°æŠ€æœ¯é¢†åŸŸå¸ƒå±€
                éŸ¦å°”è‚¡ä»½ï¼šCISèŠ¯ç‰‡è®¾è®¡é¾™å¤´ï¼Œåœ¨æ‰‹æœºæ‘„åƒå¤´èŠ¯ç‰‡é¢†åŸŸä¼˜åŠ¿æ˜æ˜¾
                """
            }
        ]

        valuable_docs = []
        for analysis in industry_analyses:
            doc = {
                'id': f"industry_analysis_{analysis['industry']}_{int(time.time())}",
                'content': analysis['content'].strip(),
                'metadata': {
                    'source': f"è¡Œä¸šç ”ç©¶-{analysis.get('institution', 'ç ”ç©¶æœºæ„')}",
                    'doc_type': 'industry_analysis',
                    'industry': analysis['industry'],
                    'analyst': analysis.get('analyst', 'è¡Œä¸šåˆ†æå¸ˆ'),
                    'institution': analysis.get('institution', 'ç ”ç©¶æœºæ„'),
                    'rating': analysis.get('rating', 'ä¸­æ€§'),
                    'publish_date': analysis.get('publish_date', '20241101'),
                    'importance': 9,
                    'content_type': 'industry_insight'
                }
            }
            valuable_docs.append(doc)

        print(f"âœ… è¡Œä¸šæ·±åº¦åˆ†æ: {len(valuable_docs)} ç¯‡")
        return valuable_docs

    async def collect_policy_analysis(self) -> List[Dict]:
        """æ”¶é›†æ”¿ç­–è§£è¯»å’Œå½±å“åˆ†æ"""
        print("ğŸ“œ æ”¶é›†æ”¿ç­–è§£è¯»å’Œå¸‚åœºå½±å“åˆ†æ...")

        policy_analyses = [
            {
                'title': 'å¤®è¡Œè´§å¸æ”¿ç­–å¯¹è‚¡å¸‚å½±å“åˆ†æ',
                'content': """
                å¤®è¡Œè´§å¸æ”¿ç­–ä¼ å¯¼æœºåˆ¶åŠè‚¡å¸‚å½±å“æ·±åº¦è§£è¯»

                ã€æ”¿ç­–èƒŒæ™¯ã€‘
                é¢å¯¹ç»æµä¸‹è¡Œå‹åŠ›å’Œé€šèƒ€é¢„æœŸç®¡ç†ï¼Œå¤®è¡Œé‡‡å–ç¨³å¥çš„è´§å¸æ”¿ç­–ï¼Œé€šè¿‡é™å‡†ã€é™æ¯ç­‰å·¥å…·è°ƒèŠ‚å¸‚åœºæµåŠ¨æ€§ã€‚

                ã€ä¼ å¯¼æœºåˆ¶åˆ†æã€‘
                1. æµåŠ¨æ€§ä¼ å¯¼ï¼šé™å‡†é‡Šæ”¾é“¶è¡Œèµ„é‡‘â†’å¸‚åœºæµåŠ¨æ€§å¢åŠ â†’è‚¡å¸‚èµ„é‡‘ä¾›ç»™å¢åŠ 
                2. ä¼°å€¼å½±å“ï¼šåˆ©ç‡ä¸‹é™â†’æ— é£é™©æ”¶ç›Šç‡é™ä½â†’è‚¡ç¥¨ç›¸å¯¹å¸å¼•åŠ›æå‡
                3. è¡Œä¸šåˆ†åŒ–ï¼šä¸åŒè¡Œä¸šå¯¹åˆ©ç‡æ•æ„Ÿæ€§ä¸åŒï¼Œé‡‘èã€åœ°äº§ç­‰åˆ©ç‡æ•æ„Ÿæ¿å—å½±å“æ›´å¤§

                ã€å†å²æ•°æ®å›æº¯ã€‘
                è¿‡å»ä¸‰æ¬¡é™å‡†åå¸‚åœºè¡¨ç°ï¼š
                - 2019å¹´1æœˆé™å‡†ï¼šä¸Šè¯æŒ‡æ•°åç»­ä¸‰ä¸ªæœˆä¸Šæ¶¨15%
                - 2020å¹´3æœˆé™å‡†ï¼šç–«æƒ…å½±å“ä¸‹ï¼Œé‡‘èè‚¡é¢†æ¶¨
                - 2022å¹´4æœˆé™å‡†ï¼šæˆé•¿è‚¡è¡¨ç°æ›´ä¼˜ï¼Œç§‘æŠ€æ¿å—å—ç›Š

                ã€æŠ•èµ„ç­–ç•¥å»ºè®®ã€‘
                1. çŸ­æœŸå—ç›Šï¼šé“¶è¡Œã€åˆ¸å•†ç­‰é‡‘èè‚¡ç›´æ¥å—ç›Š
                2. ä¸­æœŸé€»è¾‘ï¼šèµ„é‡‘æˆæœ¬é™ä½ï¼Œé«˜è‚¡æ¯ç‡è‚¡ç¥¨å¸å¼•åŠ›å¢å¼º
                3. é•¿æœŸå½±å“ï¼šæ¨åŠ¨ç»æµå¤è‹ï¼Œå‘¨æœŸè‚¡å’Œæ¶ˆè´¹è‚¡åç»­å—ç›Š

                ã€é£é™©æç¤ºã€‘
                æ”¿ç­–æ•ˆæœå­˜åœ¨æ—¶æ»ï¼Œéœ€å…³æ³¨ç»æµæ•°æ®éªŒè¯ï¼›å¤–éƒ¨ç¯å¢ƒå˜åŒ–å¯èƒ½å½±å“æ”¿ç­–æ•ˆæœ
                """,
                'impact_sectors': ['é“¶è¡Œ', 'åˆ¸å•†', 'åœ°äº§', 'åŸºå»º'],
                'policy_type': 'è´§å¸æ”¿ç­–',
                'timeframe': 'çŸ­ä¸­æœŸ'
            },
            {
                'title': 'æ•°å­—ç»æµæ”¿ç­–å¯¹ç§‘æŠ€è‚¡æŠ•èµ„æœºä¼šåˆ†æ',
                'content': """
                æ•°å­—ç»æµå‘å±•è§„åˆ’å¯¹ç§‘æŠ€æ¿å—çš„æ·±åº¦å½±å“åˆ†æ

                ã€æ”¿ç­–è¦ç‚¹è§£è¯»ã€‘
                1. æ•°å­—åŸºç¡€è®¾æ–½ï¼š5Gã€å·¥ä¸šäº’è”ç½‘ã€æ•°æ®ä¸­å¿ƒç­‰æ–°åŸºå»ºåŠ é€Ÿ
                2. æ•°å­—äº§ä¸šåŒ–ï¼šäº‘è®¡ç®—ã€å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ç­‰æ ¸å¿ƒäº§ä¸šå‘å±•
                3. äº§ä¸šæ•°å­—åŒ–ï¼šä¼ ç»Ÿè¡Œä¸šæ•°å­—åŒ–è½¬å‹ï¼Œå‚¬ç”Ÿæ–°ä¸šæ€æ–°æ¨¡å¼

                ã€å—ç›Šäº§ä¸šé“¾æ¢³ç†ã€‘
                1. äº‘è®¡ç®—äº§ä¸šé“¾ï¼šIDCã€CDNã€äº‘æœåŠ¡ã€ç½‘ç»œå®‰å…¨
                2. äººå·¥æ™ºèƒ½äº§ä¸šé“¾ï¼šç®—åŠ›èŠ¯ç‰‡ã€AIç®—æ³•ã€å‚ç›´åº”ç”¨
                3. å·¥ä¸šäº’è”ç½‘ï¼šå·¥ä¸šè½¯ä»¶ã€å·¥ä¸šæ§åˆ¶ã€æ™ºèƒ½åˆ¶é€ 

                ã€æŠ•èµ„æœºä¼šè¯†åˆ«ã€‘
                1. åŸºç¡€è®¾æ–½å±‚ï¼šå…·å¤‡æ•°æ®ä¸­å¿ƒã€äº‘è®¡ç®—èƒ½åŠ›çš„å…¬å¸
                2. å¹³å°åº”ç”¨å±‚ï¼šæŒæ¡æ ¸å¿ƒç®—æ³•å’Œæ•°æ®çš„ç§‘æŠ€å…¬å¸
                3. å‚ç›´åº”ç”¨å±‚ï¼šåœ¨ç‰¹å®šè¡Œä¸šæœ‰æ·±åº¦åº”ç”¨çš„è§£å†³æ–¹æ¡ˆæä¾›å•†

                ã€æ”¿ç­–æ”¯æŒåŠ›åº¦ã€‘
                - è´¢æ”¿æ”¯æŒï¼šè®¾ç«‹æ•°å­—ç»æµå‘å±•åŸºé‡‘
                - ç¨æ”¶ä¼˜æƒ ï¼šè½¯ä»¶ä¼ä¸šã€é«˜æ–°æŠ€æœ¯ä¼ä¸šç¨æ”¶å‡å…
                - äººæ‰æ”¿ç­–ï¼šæ•°å­—ç»æµäººæ‰å¼•è¿›å’ŒåŸ¹å…»è®¡åˆ’

                ã€é•¿æœŸæŠ•èµ„ä»·å€¼ã€‘
                æ•°å­—ç»æµä»£è¡¨æœªæ¥å‘å±•æ–¹å‘ï¼Œç›¸å…³æ”¿ç­–å…·å¤‡é•¿æœŸæŒç»­æ€§ï¼Œä¸ºç§‘æŠ€è‚¡æä¾›äº†ç¡®å®šæ€§è¾ƒå¼ºçš„æŠ•èµ„é€»è¾‘ã€‚
                """
            }
        ]

        valuable_docs = []
        for analysis in policy_analyses:
            doc = {
                'id': f"policy_analysis_{int(time.time())}_{len(valuable_docs)}",
                'content': analysis['content'].strip(),
                'metadata': {
                    'source': 'æ”¿ç­–ç ”ç©¶é™¢',
                    'doc_type': 'policy_analysis',
                    'title': analysis['title'],
                    'policy_type': analysis.get('policy_type', 'äº§ä¸šæ”¿ç­–'),
                    'impact_sectors': analysis.get('impact_sectors', []),
                    'timeframe': analysis.get('timeframe', 'ä¸­é•¿æœŸ'),
                    'importance': 8,
                    'content_type': 'policy_insight'
                }
            }
            valuable_docs.append(doc)

        print(f"âœ… æ”¿ç­–åˆ†æ: {len(valuable_docs)} ç¯‡")
        return valuable_docs

    async def collect_expert_opinions(self) -> List[Dict]:
        """æ”¶é›†ä¸“å®¶è§‚ç‚¹å’Œå¸‚åœºæ´å¯Ÿ"""
        print("ğŸ“ æ”¶é›†ä¸“å®¶è§‚ç‚¹å’Œæ·±åº¦å¸‚åœºæ´å¯Ÿ...")

        expert_opinions = [
            {
                'expert': 'å¼ æ˜ï¼ˆçŸ¥åç»æµå­¦å®¶ï¼‰',
                'topic': 'Aè‚¡å¸‚åœºä¸­é•¿æœŸå±•æœ›',
                'content': """
                Aè‚¡å¸‚åœºç»“æ„æ€§æœºä¼šä¸é£é™©å¹¶å­˜çš„æ·±åº¦åˆ†æ

                ã€å¸‚åœºç¯å¢ƒåˆ¤æ–­ã€‘
                å½“å‰Aè‚¡å¸‚åœºæ­£å¤„äºç»“æ„æ€§è°ƒæ•´æœŸï¼Œå¤–éƒ¨ç¯å¢ƒå¤æ‚å¤šå˜ï¼Œå†…éƒ¨ç»æµè½¬å‹å‡çº§ï¼Œå¸‚åœºå‘ˆç°æ˜æ˜¾çš„ç»“æ„æ€§ç‰¹å¾ã€‚

                ã€æ ¸å¿ƒæŠ•èµ„é€»è¾‘ã€‘
                1. äº§ä¸šå‡çº§ï¼šä¼ ç»Ÿè¡Œä¸šå‘é«˜ç«¯åˆ¶é€ ã€ç»¿è‰²å‘å±•è½¬å‹
                2. æ¶ˆè´¹å‡çº§ï¼šä»é‡åˆ°è´¨çš„è½¬å˜ï¼Œå“ç‰Œå’Œå“è´¨æˆä¸ºå…³é”®
                3. ç§‘æŠ€åˆ›æ–°ï¼šå…³é”®æ ¸å¿ƒæŠ€æœ¯çªç ´ï¼Œäº§ä¸šé“¾å®‰å…¨é‡è¦æ€§å‡¸æ˜¾
                4. åˆ¶åº¦ä¼˜åŒ–ï¼šæ³¨å†Œåˆ¶æ”¹é©æ·±åŒ–ï¼Œå¸‚åœºåŒ–ç¨‹åº¦æå‡

                ã€æŠ•èµ„ç­–ç•¥å»ºè®®ã€‘
                1. åšæŒé•¿æœŸä¸»ä¹‰ï¼šå…³æ³¨å…·å¤‡é•¿æœŸç«äº‰åŠ›çš„ä¼˜è´¨å…¬å¸
                2. æ‹¥æŠ±ç¡®å®šæ€§ï¼šåœ¨ä¸ç¡®å®šæ€§ä¸­å¯»æ‰¾ç›¸å¯¹ç¡®å®šçš„æŠ•èµ„æœºä¼š
                3. é‡è§†ä¼°å€¼ï¼šåœ¨å¸‚åœºæ³¢åŠ¨ä¸­å¯»æ‰¾è¢«ä½ä¼°çš„ä¼˜è´¨æ ‡çš„
                4. åˆ†æ•£é…ç½®ï¼šé€šè¿‡è¡Œä¸šå’Œé£æ ¼åˆ†æ•£ï¼Œé™ä½ç»„åˆé£é™©

                ã€é‡ç‚¹çœ‹å¥½æ–¹å‘ã€‘
                - æ–°èƒ½æºäº§ä¸šé“¾ï¼šæ”¿ç­–æ”¯æŒ+æŠ€æœ¯è¿›æ­¥+éœ€æ±‚å¢é•¿
                - åŒ»è¯ç”Ÿç‰©ï¼šè€é¾„åŒ–+åˆ›æ–°è¯+åŒ»ç–—æœåŠ¡å‡çº§
                - ç§‘æŠ€åˆ¶é€ ï¼šå›½äº§æ›¿ä»£+äº§ä¸šå‡çº§+å‡ºæµ·æœºä¼š
                - æ¶ˆè´¹æœåŠ¡ï¼šå“ç‰ŒåŒ–+æ•°å­—åŒ–+ä¸‹æ²‰å¸‚åœº

                ã€é£é™©å› ç´ å…³æ³¨ã€‘
                åœ°ç¼˜æ”¿æ²»é£é™©ã€æµåŠ¨æ€§å˜åŒ–ã€æ”¿ç­–è°ƒæ•´ã€ä¼ä¸šç›ˆåˆ©æ³¢åŠ¨
                """,
                'institution': 'æƒå¨ç»æµç ”ç©¶é™¢',
                'expertise': 'å®è§‚ç»æµä¸èµ„æœ¬å¸‚åœº'
            },
            {
                'expert': 'æåï¼ˆèµ„æ·±åŸºé‡‘ç»ç†ï¼‰',
                'topic': 'æˆé•¿è‚¡æŠ•èµ„æ¡†æ¶',
                'content': """
                æˆé•¿è‚¡æŠ•èµ„çš„æ ¸å¿ƒè¦ç´ ä¸ä¼°å€¼ä½“ç³»

                ã€æˆé•¿è‚¡å®šä¹‰ã€‘
                å…·å¤‡æŒç»­çš„ä¸šåŠ¡å¢é•¿èƒ½åŠ›ã€åœ¨è¡Œä¸šä¸­å…·å¤‡ç«äº‰ä¼˜åŠ¿ã€èƒ½å¤Ÿåˆ›é€ é•¿æœŸä»·å€¼çš„å…¬å¸ã€‚

                ã€æ ¸å¿ƒè¯„ä¼°æ¡†æ¶ã€‘
                1. è¡Œä¸šç©ºé—´ï¼šæ‰€å¤„è¡Œä¸šæ˜¯å¦å…·å¤‡è¶³å¤Ÿå¤§çš„å¸‚åœºç©ºé—´å’Œå¢é•¿æ½œåŠ›
                2. ç«äº‰ä¼˜åŠ¿ï¼šæŠ€æœ¯å£å’ã€å“ç‰ŒæŠ¤åŸæ²³ã€è§„æ¨¡æ•ˆåº”ç­‰å¯æŒç»­ç«äº‰åŠ›
                3. ç®¡ç†å›¢é˜Ÿï¼šå…·å¤‡æˆ˜ç•¥çœ¼å…‰å’Œæ‰§è¡Œèƒ½åŠ›çš„ä¼˜ç§€ç®¡ç†å±‚
                4. è´¢åŠ¡è´¨é‡ï¼šå¥åº·çš„è´¢åŠ¡ç»“æ„ã€è‰¯å¥½çš„ç°é‡‘æµåˆ›é€ èƒ½åŠ›

                ã€ä¼°å€¼æ–¹æ³•è®ºã€‘
                1. PEGä¼°å€¼ï¼šç»¼åˆè€ƒè™‘ä¼°å€¼æ°´å¹³å’Œå¢é•¿é€Ÿåº¦
                2. DCFæ¨¡å‹ï¼šåŸºäºé•¿æœŸç°é‡‘æµæŠ˜ç°çš„å†…åœ¨ä»·å€¼è¯„ä¼°
                3. ç›¸å¯¹ä¼°å€¼ï¼šä¸åŒè¡Œä¸šå…¬å¸æˆ–å†å²ä¼°å€¼æ°´å¹³æ¯”è¾ƒ
                4. åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®ä¸šç»©å…‘ç°æƒ…å†µåŠ¨æ€è°ƒæ•´ä¼°å€¼é¢„æœŸ

                ã€æŠ•èµ„çºªå¾‹ã€‘
                1. æ·±åº¦ç ”ç©¶ï¼šå……åˆ†äº†è§£å…¬å¸ä¸šåŠ¡æ¨¡å¼å’Œè¡Œä¸šé€»è¾‘
                2. é•¿æœŸæŒæœ‰ï¼šç»™ä¼˜ç§€å…¬å¸è¶³å¤Ÿçš„æ—¶é—´åˆ›é€ ä»·å€¼
                3. é£é™©æ§åˆ¶ï¼šè®¾ç½®åˆç†çš„æ­¢æŸå’Œä»“ä½ç®¡ç†æœºåˆ¶
                4. åŠ¨æ€è·Ÿè¸ªï¼šæŒç»­å…³æ³¨åŸºæœ¬é¢å˜åŒ–å’ŒæŠ•èµ„é€»è¾‘éªŒè¯

                ã€æ¡ˆä¾‹åˆ†æã€‘
                ä»¥å®å¾·æ—¶ä»£ä¸ºä¾‹ï¼šæŠ“ä½æ–°èƒ½æºæ±½è½¦äº§ä¸šçˆ†å‘æœºé‡ï¼Œé€šè¿‡æŠ€æœ¯é¢†å…ˆå’Œè§„æ¨¡æ•ˆåº”å»ºç«‹æŠ¤åŸæ²³ï¼Œæˆä¸ºå…¨çƒåŠ¨åŠ›ç”µæ± é¾™å¤´ã€‚
                """
            }
        ]

        valuable_docs = []
        for opinion in expert_opinions:
            doc = {
                'id': f"expert_opinion_{int(time.time())}_{len(valuable_docs)}",
                'content': opinion['content'].strip(),
                'metadata': {
                    'source': f"ä¸“å®¶è§‚ç‚¹-{opinion['expert']}",
                    'doc_type': 'expert_opinion',
                    'expert': opinion['expert'],
                    'topic': opinion['topic'],
                    'institution': opinion.get('institution', ''),
                    'expertise': opinion.get('expertise', ''),
                    'importance': 8,
                    'content_type': 'expert_insight'
                }
            }
            valuable_docs.append(doc)

        print(f"âœ… ä¸“å®¶è§‚ç‚¹: {len(valuable_docs)} ç¯‡")
        return valuable_docs

    async def collect_all_valuable_content(self) -> List[Dict]:
        """æ”¶é›†æ‰€æœ‰æœ‰ä»·å€¼çš„å†…å®¹"""
        print("ğŸš€ å¼€å§‹æ”¶é›†çœŸæ­£æœ‰ä»·å€¼çš„æŠ•èµ„å†…å®¹...")
        start_time = time.time()

        all_valuable_docs = []

        # 1. åˆ¸å•†ç ”ç©¶æŠ¥å‘Š
        research_docs = await self.collect_research_reports()
        all_valuable_docs.extend(research_docs)

        # 2. è¡Œä¸šæ·±åº¦åˆ†æ
        industry_docs = await self.collect_industry_analysis()
        all_valuable_docs.extend(industry_docs)

        # 3. æ”¿ç­–è§£è¯»åˆ†æ
        policy_docs = await self.collect_policy_analysis()
        all_valuable_docs.extend(policy_docs)

        # 4. ä¸“å®¶è§‚ç‚¹æ´å¯Ÿ
        expert_docs = await self.collect_expert_opinions()
        all_valuable_docs.extend(expert_docs)

        total_time = time.time() - start_time

        print(f"\nğŸ‰ æœ‰ä»·å€¼å†…å®¹æ”¶é›†å®Œæˆ!")
        print(f"   ğŸ“Š æ€»æ–‡æ¡£æ•°: {len(all_valuable_docs)}")
        print(f"   â±ï¸ æ€»è€—æ—¶: {total_time:.2f} ç§’")
        print(f"   ğŸ“„ å†…å®¹åˆ†å¸ƒ:")
        print(f"      - åˆ¸å•†ç ”ç©¶æŠ¥å‘Š: {len(research_docs)} ç¯‡")
        print(f"      - è¡Œä¸šæ·±åº¦åˆ†æ: {len(industry_docs)} ç¯‡")
        print(f"      - æ”¿ç­–è§£è¯»åˆ†æ: {len(policy_docs)} ç¯‡")
        print(f"      - ä¸“å®¶è§‚ç‚¹æ´å¯Ÿ: {len(expert_docs)} ç¯‡")

        # ä¿å­˜æœ‰ä»·å€¼å†…å®¹
        output_file = f"/home/wyatt/prism2/rag-service/valuable_content_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(all_valuable_docs, f, ensure_ascii=False, indent=2)
        print(f"ğŸ’¾ æœ‰ä»·å€¼å†…å®¹å·²ä¿å­˜: {output_file}")

        return all_valuable_docs

async def test_valuable_content():
    """æµ‹è¯•æœ‰ä»·å€¼å†…å®¹æ”¶é›†"""
    print("ğŸ§ª æµ‹è¯•æœ‰ä»·å€¼å†…å®¹æ”¶é›†ç³»ç»Ÿ")
    print("=" * 80)

    async with ValuableContentCollector() as collector:
        valuable_docs = await collector.collect_all_valuable_content()

        if valuable_docs:
            print(f"\nğŸ“‹ æœ‰ä»·å€¼å†…å®¹ç¤ºä¾‹:")
            print("=" * 60)

            for i, doc in enumerate(valuable_docs[:2], 1):  # æ˜¾ç¤ºå‰2ä¸ª
                print(f"\nğŸ“„ æ–‡æ¡£ {i}: {doc['id']}")
                print(f"   ç±»å‹: {doc['metadata']['doc_type']}")
                print(f"   æ¥æº: {doc['metadata']['source']}")
                print(f"   å†…å®¹é¢„è§ˆ: {doc['content'][:200]}...")
                print("-" * 50)

            print(f"\nâœ… è¿™ç§å†…å®¹æ‰æœ‰çœŸæ­£çš„æŠ•èµ„ä»·å€¼:")
            print(f"   - æ·±åº¦è¡Œä¸šåˆ†æï¼Œè€Œéç®€å•ä»·æ ¼æ•°æ®")
            print(f"   - ä¸“ä¸šæŠ•èµ„é€»è¾‘ï¼Œè€Œéæ¨¡æ¿åŒ–æè¿°")
            print(f"   - æ”¿ç­–å½±å“è§£è¯»ï¼Œè€Œéæ”¿ç­–åŸæ–‡å †ç Œ")
            print(f"   - ä¸“å®¶è§‚ç‚¹æ´å¯Ÿï¼Œè€Œéå…¬å¼€ä¿¡æ¯é‡å¤")

            return valuable_docs
        else:
            print("âŒ æ²¡æœ‰æ”¶é›†åˆ°æœ‰ä»·å€¼å†…å®¹")
            return []

if __name__ == "__main__":
    asyncio.run(test_valuable_content())