# Prism2 ç³»ç»Ÿè‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—

## æ–‡æ¡£ä¿¡æ¯
- **åˆ›å»ºæ—¶é—´**: 2025-09-16
- **é€‚ç”¨ç¯å¢ƒ**: Ubuntu 20.04+ / WSL2
- **ç›®æ ‡ç”¨æˆ·**: AIåŠ©æ‰‹ã€ç³»ç»Ÿç®¡ç†å‘˜ã€å¼€å‘è€…
- **éƒ¨ç½²æ—¶é—´**: çº¦2-3å°æ—¶

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
```bash
# æœ€å°é…ç½®
CPU: 4æ ¸å¿ƒ
å†…å­˜: 6GB (è½»é‡æ¨¡å‹) / 10GB (æ ‡å‡†æ¨¡å‹)
ç£ç›˜: 30GB å¯ç”¨ç©ºé—´
ç½‘ç»œ: 100Mbps

# æ¨èé…ç½®
CPU: 6æ ¸å¿ƒ
å†…å­˜: 12GB
ç£ç›˜: 50GB SSD
ç½‘ç»œ: 1000Mbps
```

### æ“ä½œç³»ç»Ÿè¦æ±‚
```bash
# æ£€æŸ¥ç³»ç»Ÿç‰ˆæœ¬
lsb_release -a
# è¦æ±‚: Ubuntu 20.04+ æˆ–å…¼å®¹å‘è¡Œç‰ˆ

# æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬
uname -r
# è¦æ±‚: Linux å†…æ ¸ >= 3.10
```

## é¢„å®‰è£…æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# æ–‡ä»¶å: pre_install_check.sh

echo "=== Prism2 é¢„å®‰è£…ç³»ç»Ÿæ£€æŸ¥ ==="

# æ£€æŸ¥æ“ä½œç³»ç»Ÿ
OS_VERSION=$(lsb_release -rs)
echo "æ“ä½œç³»ç»Ÿç‰ˆæœ¬: Ubuntu $OS_VERSION"
if (( $(echo "$OS_VERSION >= 20.04" | bc -l) )); then
    echo "âœ… æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç¬¦åˆè¦æ±‚"
else
    echo "âŒ æ“ä½œç³»ç»Ÿç‰ˆæœ¬è¿‡ä½ï¼Œéœ€è¦ Ubuntu 20.04+"
    exit 1
fi

# æ£€æŸ¥å†…å­˜
MEMORY_GB=$(free -g | awk '/^Mem:/{print $2}')
echo "ç³»ç»Ÿå†…å­˜: ${MEMORY_GB}GB"
if [ $MEMORY_GB -ge 6 ]; then
    echo "âœ… å†…å­˜å……è¶³"
else
    echo "âŒ å†…å­˜ä¸è¶³ï¼Œæœ€å°‘éœ€è¦6GB"
    exit 1
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
DISK_SPACE_GB=$(df -BG / | awk 'NR==2 {print $4}' | sed 's/G//')
echo "å¯ç”¨ç£ç›˜ç©ºé—´: ${DISK_SPACE_GB}GB"
if [ $DISK_SPACE_GB -ge 30 ]; then
    echo "âœ… ç£ç›˜ç©ºé—´å……è¶³"
else
    echo "âŒ ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œæœ€å°‘éœ€è¦30GB"
    exit 1
fi

# æ£€æŸ¥ç«¯å£å ç”¨
PORTS=(5432 6379 80 443 11434 8000 8081 3001 5555)
echo "æ£€æŸ¥ç«¯å£å ç”¨çŠ¶æ€:"
for port in "${PORTS[@]}"; do
    if ss -tuln | grep -q ":$port "; then
        echo "âŒ ç«¯å£ $port å·²è¢«å ç”¨"
        exit 1
    else
        echo "âœ… ç«¯å£ $port å¯ç”¨"
    fi
done

echo "ğŸ‰ ç³»ç»Ÿæ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹å®‰è£…ï¼"
```

## ç¬¬ä¸€é˜¶æ®µï¼šç³»ç»ŸåŸºç¡€ç¯å¢ƒ

### 1.1 æ›´æ–°ç³»ç»ŸåŒ…
```bash
# æ›´æ–°åŒ…ç´¢å¼•
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y \
    curl \
    wget \
    git \
    vim \
    htop \
    tree \
    unzip \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release
```

### 1.2 å®‰è£…Python 3.12ç¯å¢ƒ
```bash
# æ·»åŠ deadsnakes PPAæº
sudo add-apt-repository ppa:deadsnakes/ppa -y
sudo apt update

# å®‰è£…Python 3.12
sudo apt install -y \
    python3.12 \
    python3.12-dev \
    python3.12-venv \
    python3-pip

# è®¾ç½®Python 3.12ä¸ºé»˜è®¤ç‰ˆæœ¬
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.12 1
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.12 1

# éªŒè¯å®‰è£…
python --version  # åº”æ˜¾ç¤º Python 3.12.x
pip3 --version
```

### 1.3 å®‰è£…Node.js 18 LTS
```bash
# å®‰è£…NodeSourceä»“åº“
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -

# å®‰è£…Node.js
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version  # åº”æ˜¾ç¤º v18.x.x
npm --version
```

## ç¬¬äºŒé˜¶æ®µï¼šå®¹å™¨åŒ–å¹³å°

### 2.1 å®‰è£…Podman
```bash
# å®‰è£…Podman
sudo apt update
sudo apt install -y podman

# é…ç½®Podmanæ³¨å†Œè¡¨
sudo mkdir -p /etc/containers
cat << 'EOF' | sudo tee /etc/containers/registries.conf
[registries.search]
registries = ['docker.io', 'quay.io']

[registries.insecure]
registries = []

[registries.block]
registries = []
EOF

# éªŒè¯å®‰è£…
podman --version
podman info
```

### 2.2 å®‰è£…Podman Compose
```bash
# å®‰è£…pipåŒ…ç®¡ç†å™¨ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo apt install -y python3-pip

# å®‰è£…podman-compose
pip3 install podman-compose

# éªŒè¯å®‰è£…
podman-compose --version

# åˆ›å»ºåˆ«åæ–¹ä¾¿ä½¿ç”¨
echo 'alias docker-compose=podman-compose' >> ~/.bashrc
echo 'alias docker=podman' >> ~/.bashrc
source ~/.bashrc
```

## ç¬¬ä¸‰é˜¶æ®µï¼šæ•°æ®åº“æœåŠ¡

### 3.1 å¯åŠ¨PostgreSQLå®¹å™¨
```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p ~/prism2/data/postgres

# å¯åŠ¨PostgreSQLå®¹å™¨
podman run -d \
    --name prism2-postgres \
    --restart unless-stopped \
    -p 5432:5432 \
    -e POSTGRES_DB=prism2 \
    -e POSTGRES_USER=prism2 \
    -e POSTGRES_PASSWORD=prism2_secure_password \
    -v ~/prism2/data/postgres:/var/lib/postgresql/data \
    docker.io/timescale/timescaledb:latest-pg15

# éªŒè¯å¯åŠ¨
podman ps | grep postgres
podman logs prism2-postgres
```

### 3.2 å¯åŠ¨Rediså®¹å™¨
```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p ~/prism2/data/redis

# å¯åŠ¨Rediså®¹å™¨
podman run -d \
    --name prism2-redis \
    --restart unless-stopped \
    -p 6379:6379 \
    -v ~/prism2/data/redis:/data \
    docker.io/redis:7-alpine \
    redis-server --appendonly yes --maxmemory 512mb --maxmemory-policy allkeys-lru

# éªŒè¯å¯åŠ¨
podman ps | grep redis
podman exec prism2-redis redis-cli ping  # åº”è¿”å› PONG
```

## ç¬¬å››é˜¶æ®µï¼šAIæ¨¡å‹æœåŠ¡

### 4.1 å®‰è£…Ollama
```bash
# ä¸‹è½½å¹¶å®‰è£…Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# å¯åŠ¨OllamaæœåŠ¡
sudo systemctl enable ollama
sudo systemctl start ollama

# éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status ollama
curl http://localhost:11434/api/version
```

### 4.2 ä¸‹è½½AIæ¨¡å‹
```bash
# ä¸‹è½½DeepSeek-1.3Bï¼ˆè½»é‡æ¨¡å‹ï¼Œä¼˜å…ˆï¼‰
ollama pull deepseek-coder:1.3b-instruct

# ä¸‹è½½Qwen2.5-7Bï¼ˆä¸»è¦æ¨¡å‹ï¼‰
ollama pull qwen2.5:7b-instruct

# ä¸‹è½½DeepSeek-6.7Bï¼ˆå¯¹æ¯”æ¨¡å‹ï¼‰
ollama pull deepseek-coder:6.7b-instruct

# éªŒè¯æ¨¡å‹ä¸‹è½½
ollama list
```

### 4.3 å¯åŠ¨ChromaDB
```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p ~/prism2/data/chromadb

# å¯åŠ¨ChromaDBå®¹å™¨
podman run -d \
    --name prism2-chromadb \
    --restart unless-stopped \
    -p 8000:8000 \
    -v ~/prism2/data/chromadb:/chroma/chroma \
    docker.io/chromadb/chroma:latest

# éªŒè¯å¯åŠ¨
podman ps | grep chromadb
curl http://localhost:8000/api/v1/version
```

## ç¬¬äº”é˜¶æ®µï¼šPythonç¯å¢ƒå’Œä¾èµ–

### 5.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p ~/prism2
cd ~/prism2

# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
python3.12 -m venv prism2_env

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source prism2_env/bin/activate

# å‡çº§pip
pip install --upgrade pip
```

### 5.2 å®‰è£…Pythonä¾èµ–åŒ…
```bash
# åˆ›å»ºrequirements.txtæ–‡ä»¶
cat << 'EOF' > requirements.txt
# Webæ¡†æ¶
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0

# æ•°æ®åº“
psycopg2-binary==2.9.9
redis==5.0.1
sqlalchemy==2.0.23
alembic==1.13.1

# AIå’Œå‘é‡åŒ–
langchain==0.0.339
langchain-community==0.0.1
chromadb==0.4.18
sentence-transformers==2.2.2
transformers==4.36.2

# çˆ¬è™«å’Œæ•°æ®å¤„ç†
scrapy==2.11.0
requests==2.31.0
beautifulsoup4==4.12.2
lxml==4.9.3
pandas==2.1.4
numpy==1.26.2

# ä»»åŠ¡é˜Ÿåˆ—
celery[redis]==5.3.4
flower==2.0.1

# è°ƒåº¦å™¨
apscheduler==3.10.4

# å®ç”¨å·¥å…·
python-dotenv==1.0.0
pyyaml==6.0.1
python-multipart==0.0.6
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# å¼€å‘å·¥å…·
pytest==7.4.3
pytest-asyncio==0.21.1
black==23.11.0
flake8==6.1.0
EOF

# å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt

# éªŒè¯å®‰è£…
python -c "import fastapi, scrapy, celery, pandas; print('âœ… æ‰€æœ‰PythonåŒ…å®‰è£…æˆåŠŸ')"
```

## ç¬¬å…­é˜¶æ®µï¼šWebæœåŠ¡å’Œç®¡ç†å·¥å…·

### 6.1 å¯åŠ¨Nginx
```bash
# åˆ›å»ºé…ç½®ç›®å½•
mkdir -p ~/prism2/config/nginx

# åˆ›å»ºåŸºç¡€Nginxé…ç½®
cat << 'EOF' > ~/prism2/config/nginx/default.conf
server {
    listen 80;
    server_name localhost;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://host.containers.internal:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Ollamaä»£ç†
    location /ollama/ {
        proxy_pass http://host.containers.internal:11434/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
EOF

# å¯åŠ¨Nginxå®¹å™¨
podman run -d \
    --name prism2-nginx \
    --restart unless-stopped \
    -p 80:80 \
    -p 443:443 \
    -v ~/prism2/config/nginx/default.conf:/etc/nginx/conf.d/default.conf \
    docker.io/nginx:alpine

# éªŒè¯å¯åŠ¨
podman ps | grep nginx
curl http://localhost
```

### 6.2 å¯åŠ¨ç®¡ç†å·¥å…·
```bash
# å¯åŠ¨Redis Commander
podman run -d \
    --name prism2-redis-commander \
    --restart unless-stopped \
    -p 8081:8081 \
    -e REDIS_HOSTS=host.containers.internal:6379 \
    docker.io/rediscommander/redis-commander:latest

# å¯åŠ¨Open WebUI
podman run -d \
    --name prism2-open-webui \
    --restart unless-stopped \
    -p 3001:8080 \
    -e OLLAMA_BASE_URL=http://host.containers.internal:11434 \
    -v ~/prism2/data/open-webui:/app/backend/data \
    ghcr.io/open-webui/open-webui:main

# éªŒè¯å¯åŠ¨
podman ps | grep commander
podman ps | grep open-webui
```

## ç¬¬ä¸ƒé˜¶æ®µï¼šå¯åŠ¨åº”ç”¨æœåŠ¡

### 7.1 å¯åŠ¨Celery Workerå’ŒFlower
```bash
# åœ¨prism2è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨
cd ~/prism2
source prism2_env/bin/activate

# å¯åŠ¨Celery Workerï¼ˆåå°è¿è¡Œï¼‰
celery -A app.celery worker --loglevel=info --detach

# å¯åŠ¨Flowerç›‘æ§ï¼ˆåå°è¿è¡Œï¼‰
celery -A app.celery flower --port=5555 --detach

# éªŒè¯å¯åŠ¨
ps aux | grep celery
curl http://localhost:5555
```

## éªŒè¯éƒ¨ç½²æ¸…å•

### æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
#!/bin/bash
# æ–‡ä»¶å: check_services.sh

echo "=== Prism2 æœåŠ¡çŠ¶æ€æ£€æŸ¥ ==="

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
echo "ğŸ“¦ å®¹å™¨æœåŠ¡:"
services=(prism2-postgres prism2-redis prism2-chromadb prism2-nginx prism2-redis-commander prism2-open-webui)
for service in "${services[@]}"; do
    if podman ps --format "{{.Names}}" | grep -q "$service"; then
        echo "âœ… $service è¿è¡Œä¸­"
    else
        echo "âŒ $service æœªè¿è¡Œ"
    fi
done

# æ£€æŸ¥ç«¯å£
echo "ğŸŒ ç«¯å£æ£€æŸ¥:"
ports=(5432 6379 8000 11434 80 8081 3001 5555)
for port in "${ports[@]}"; do
    if ss -tuln | grep -q ":$port "; then
        echo "âœ… ç«¯å£ $port å·²ç›‘å¬"
    else
        echo "âŒ ç«¯å£ $port æœªç›‘å¬"
    fi
done

# æ£€æŸ¥AIæ¨¡å‹
echo "ğŸ¤– AIæ¨¡å‹:"
if command -v ollama &> /dev/null; then
    ollama list | grep -E "(deepseek|qwen)" || echo "âŒ æ¨¡å‹æœªä¸‹è½½"
else
    echo "âŒ Ollamaæœªå®‰è£…"
fi

# æ£€æŸ¥Pythonç¯å¢ƒ
echo "ğŸ Pythonç¯å¢ƒ:"
if [ -f ~/prism2/prism2_env/bin/activate ]; then
    source ~/prism2/prism2_env/bin/activate
    python -c "import fastapi, scrapy, celery; print('âœ… Pythonä¾èµ–æ­£å¸¸')" 2>/dev/null || echo "âŒ Pythonä¾èµ–ç¼ºå¤±"
    deactivate
else
    echo "âŒ Pythonè™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨"
fi

echo "ğŸ æ£€æŸ¥å®Œæˆï¼"
```

## è®¿é—®åœ°å€æ±‡æ€»

```bash
# åº”ç”¨æœåŠ¡
PostgreSQLæ•°æ®åº“: localhost:5432 (ç”¨pgAdmin4è¿æ¥)
Redisç¼“å­˜: localhost:6379
ChromaDBå‘é‡åº“: http://localhost:8000

# AIæœåŠ¡
Ollama API: http://localhost:11434
Open WebUI (æ¨¡å‹åˆ‡æ¢): http://localhost:3001

# ç®¡ç†ç•Œé¢
Redis Commander: http://localhost:8081
Flower (Celeryç›‘æ§): http://localhost:5555
ä¸»åº”ç”¨å…¥å£: http://localhost:80

# é»˜è®¤å‡­æ®
PostgreSQL: ç”¨æˆ·å=prism2, å¯†ç =prism2_secure_password, æ•°æ®åº“=prism2
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³
```bash
# å†…å­˜ä¸è¶³
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# ç«¯å£å†²çª
sudo ss -tulpn | grep :ç«¯å£å·  # æŸ¥çœ‹å ç”¨è¿›ç¨‹
sudo kill -9 PID  # ç»ˆæ­¢è¿›ç¨‹

# å®¹å™¨æ— æ³•å¯åŠ¨
podman logs å®¹å™¨å  # æŸ¥çœ‹æ—¥å¿—
podman restart å®¹å™¨å  # é‡å¯å®¹å™¨

# Pythonä¾èµ–å†²çª
pip install --force-reinstall åŒ…å
```

## å¤‡ä»½å’Œæ¢å¤

### æ•°æ®å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# æ–‡ä»¶å: backup_system.sh

BACKUP_DIR=~/prism2_backup_$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# å¤‡ä»½PostgreSQLæ•°æ®
podman exec prism2-postgres pg_dump -U prism2 prism2 > $BACKUP_DIR/postgres_backup.sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp -r ~/prism2/config $BACKUP_DIR/
cp ~/prism2/requirements.txt $BACKUP_DIR/

# å¤‡ä»½AIæ¨¡å‹åˆ—è¡¨
ollama list > $BACKUP_DIR/ollama_models.txt

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
```

---

**éƒ¨ç½²å®Œæˆåï¼Œç³»ç»Ÿç®¡ç†å‘˜æˆ–AIåŠ©æ‰‹å¯ä»¥ä½¿ç”¨è¿™ä»½æ–‡æ¡£åœ¨ä»»ä½•å…¼å®¹çš„Linuxç¯å¢ƒä¸­å®Œæ•´å¤ç°Prism2ç³»ç»Ÿã€‚**