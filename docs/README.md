# Prism2 股票分析平台 - 文档总览

> **基于4个核心原则的简化文档体系**
>
> 所有文档遵循：API隔离、共享基础设施、现成产品优先、接口固化原则

## 📋 文档结构

| 文档 | 用途 | 优先级 | 状态 |
|------|------|---------|------|
| [01-固定接口规范](./01-固定接口规范.md) | 所有API接口定义，严禁修改 | 🔥 最高 | ✅ 完成 |
| [02-共享基础设施](./02-共享基础设施.md) | Redis/PostgreSQL/Nginx配置 | 🔥 最高 | ✅ 完成 |
| [03-现成产品部署](./03-现成产品部署.md) | Docker镜像和一键部署 | ⭐ 重要 | ✅ 完成 |
| [04-问题解决手册](./04-问题解决手册.md) | 已知问题和解决方案 | ⭐ 重要 | ✅ 完成 |

## 🏗️ 系统架构 (基于架构图)

```
┌─────────────────┬──────────────────┬─────────────────┬─────────────────┐
│  Open WebUI     │   Main Page      │   Dashboard     │  Push Service   │
│  Chat Window    │  (Google-like)   │   (股票分析)     │   (滚动新闻)     │
└─────────────────┴──────────────────┴─────────────────┴─────────────────┘
         │                 │                  │                 │
         └─────────────────┼──────────────────┼─────────────────┘
                           │                  │
                      ┌────▼────┐        ┌───▼────┐
                      │大语言模型│        │Backend │
                      │QWen     │◄───────┤Http API│
                      │Deepseek │        │        │
                      └─────────┘        └───┬────┘
                                             │
        ┌─────────┬──────────┬───────────────┼───────────────┬─────────────┐
        │         │          │               │               │             │
     ┌──▼──┐   ┌─▼─┐    ┌───▼────┐      ┌──▼──┐        ┌───▼────┐    ┌──▼──┐
     │Redis│   │RAG│    │PostgreSQL    │实时查询│        │AKShare │    │Batch│
     │     │   │库 │    │(共享数据库)  │直连    │        │API    │    │处理 │
     └─────┘   └───┘    └────────────┘  └─────┘        └────────┘    └─────┘
                              ▲                           │             │
                              │                           │             │
                              └───────────────────────────┼─────────────┘
                                                          │
                                                    ┌────▼────┐
                                                    │有效RSS源│
                                                    │新浪财经 │
                                                    └─────────┘
```

## 🚀 快速开始

### 1. 环境准备
```bash
# 克隆项目
git clone [项目地址]
cd prism2

# 设置代理绕过 (重要!)
export no_proxy="localhost,127.0.0.1,::1,0.0.0.0"
export NO_PROXY="localhost,127.0.0.1,::1,0.0.0.0"
```

### 2. 一键启动
```bash
# 启动所有服务
chmod +x start.sh
./start.sh

# 检查服务状态
docker-compose ps
```

### 3. 访问系统
- **主页面**: http://localhost (Google-like搜索界面)
- **Dashboard**: http://localhost/dashboard (股票分析面板)
- **API文档**: http://localhost/docs (Swagger界面)
- **Open WebUI**: http://localhost/chat (AI对话界面)

## 📊 数据流说明

### 查询优先级 (严格执行)
```
1. Redis缓存查询 (< 1ms)
   ↓ 未命中
2. PostgreSQL数据库 (10-50ms)
   ↓ 不存在/过期
3. AKShare API调用 (200-2000ms)
```

### 实时价格特殊处理
```
实时价格请求 → 直接AKShare API → 返回结果
(不缓存，不存储，保证数据实时性)
```

### 夜间批处理流程
```
2:00-2:30  股票基础信息更新
2:30-3:30  财务报表数据获取
3:30-4:30  公司公告和新闻爬取
4:30-5:30  龙虎榜和股东数据
5:30-6:00  数据质量检查和RAG向量化
```

## 🔧 开发指南

### 开发原则 (来自CLAUDE.md)
1. **文档先行** - 修改代码前必须先更新文档
2. **接口固化** - API一旦定义不允许随意更改
3. **共享基础设施** - 严禁创建独立数据库/缓存实例
4. **现成产品优先** - 使用Docker镜像，避免自己实现

### 模块开发顺序
1. **Backend API** - 核心业务逻辑 (端口8000)
2. **RAG Service** - 向量检索服务 (端口8001)
3. **Push Service** - 推送服务 (端口8002)
4. **Frontend** - React前端界面 (端口3000)
5. **Batch Service** - 夜间批处理任务

### 添加新功能流程
1. 检查 `01-固定接口规范.md` 是否有对应接口
2. 如需新接口，先更新接口规范文档
3. 确认不违反共享基础设施原则
4. 实现功能并测试
5. 更新问题解决手册 (如遇到问题)

## ⚠️ 重要约定

### 严禁事项
- ❌ 修改已定义的API接口端点和参数
- ❌ 创建独立的数据库/Redis实例
- ❌ 绕过Nginx直接访问后端服务
- ❌ 使用未经验证的第三方数据源

### 必须遵守
- ✅ 所有HTTP流量通过Nginx代理
- ✅ 数据库连接使用连接池
- ✅ 实时价格直接从AKShare获取
- ✅ 遇到问题立即更新解决手册

## 📞 支持和维护

### 日常监控
```bash
# 检查服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f [service_name]

# 重启问题服务
docker-compose restart [service_name]
```

### 故障排除
1. 查看 `04-问题解决手册.md` 寻找已知解决方案
2. 检查代理配置是否正确设置
3. 验证数据库连接和权限
4. 确认Docker容器资源充足

### 性能优化
- **数据库**: 使用连接池，定期VACUUM
- **缓存**: 合理设置TTL，监控命中率
- **API**: 实现限流，避免过度调用AKShare
- **容器**: 设置资源限制，监控内存使用

---

**📅 文档版本**: v1.0
**🔄 最后更新**: 2025-09-18
**🎯 目标**: 简化文档，提高开发效率
**💡 原则**: 4个核心原则指导所有设计决策