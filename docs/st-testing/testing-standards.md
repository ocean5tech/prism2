# Prism2 测试标准和准则

## 🚨 核心测试原则

### 1. **禁止模拟数据测试** ❌
**严格禁止**: 所有测试必须使用真实数据源，禁止使用模拟数据、假数据、测试桩(stub)或模拟对象(mock)。

**原因**:
- 模拟测试产生虚假结果，无法验证系统真实性能
- 无法发现真实环境中的问题和瓶颈
- 无法验证数据源连接、网络延迟、API限制等真实场景
- 给出错误的性能指标和成功率数据

### 2. **真实数据源要求** ✅
**强制要求**: 所有测试必须连接到真实的数据源和服务:

#### AKShare 测试
- ✅ 必须调用真实的 AKShare API
- ✅ 必须获取真实的股票数据 (如5431只A股数据)
- ✅ 必须测量真实的网络延迟和响应时间
- ✅ 必须处理真实的API限流和错误

#### 数据库测试
- ✅ 必须连接真实的 PostgreSQL + TimescaleDB
- ✅ 必须连接真实的 Redis 缓存服务
- ✅ 必须连接真实的 ChromaDB 向量数据库

#### 外部服务测试
- ✅ 必须使用真实的RSS新闻源
- ✅ 必须调用真实的AI模型接口 (Ollama/OpenAI)
- ✅ 必须验证真实的文件I/O操作

### 3. **测试失败处理**
如果因为依赖问题无法连接真实数据源:
1. **不得降级为模拟测试**
2. **必须修复依赖问题**
3. **必须在真实环境中重新测试**
4. **测试报告必须标明"真实数据源验证"**

### 4. **性能指标标准**
- **响应时间**: 必须包含真实网络延迟
- **数据量**: 必须显示真实获取的记录数
- **成功率**: 必须反映真实的API调用成功率
- **错误率**: 必须包含真实的网络错误和超时

### 5. **测试报告要求**
每个测试报告必须包含:
- ✅ 数据源验证: 明确标注使用了哪些真实数据源
- ✅ 实际数据量: 真实获取的记录数量
- ✅ 真实执行时间: 包含网络延迟的完整时间
- ✅ 错误详情: 真实遇到的API限制、网络问题等

### 6. **开发环境要求**
为确保能够进行真实数据测试:
- 开发环境必须能访问外网API
- 必须配置正确的数据库连接
- 必须安装所有必要的依赖包
- 必须有足够的网络带宽和稳定性

## 🛠️ 实施准则

### 测试前检查清单
- [ ] 所有数据源服务正常运行
- [ ] 网络连接稳定
- [ ] API访问权限正常
- [ ] 依赖包完整安装
- [ ] 测试环境配置正确

### 测试执行准则
1. **数据源连接验证**: 测试开始前必须验证所有数据源连通性
2. **真实数据获取**: 必须从生产API获取真实数据
3. **完整错误处理**: 必须测试真实的错误场景和恢复机制
4. **性能基准测试**: 使用真实数据建立性能基准

### 测试报告标准
- 标题必须包含"真实数据源测试"
- 必须列出所有使用的真实API和数据源
- 必须提供真实的性能数据和错误统计
- 发现问题必须在真实环境中验证和修复

## ❌ 违规行为

以下行为被严格禁止:
- 使用mock、stub、fake等模拟对象
- 预设测试数据而非API获取
- 硬编码响应时间而非真实测量
- 跳过网络调用使用本地数据
- 篡改或美化测试结果

## ✅ 最佳实践

1. **测试环境接近生产**: 使用与生产环境相同的数据源和配置
2. **完整集成测试**: 测试完整的数据流从API到存储的全过程
3. **压力测试**: 使用真实数据量进行性能压力测试
4. **边界测试**: 测试API限制、网络异常等真实边界条件
5. **持续监控**: 建立基于真实数据的持续集成测试

---

**记住**: 只有真实数据测试才能确保系统在生产环境中的可靠性和性能表现。模拟测试是虚假结果，会掩盖真实问题并误导开发决策。